<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- HTML Meta Tags -->
    <title> PeerWeb - Decentralized Website Hosting</title>
    <meta name="description" content="PeerWeb is a revolutionary way to host and share websites using WebTorrent technology. Instead of relying on centralized servers, websites are distributed across a peer-to-peer network, making them censorship-resistant and always available. üåç‚ú®">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://peerweb.lol/">
    <meta property="og:type" content="website">
    <meta property="og:title" content=" PeerWeb - Decentralized Website Hosting">
    <meta property="og:description" content="PeerWeb is a revolutionary way to host and share websites using WebTorrent technology. Instead of relying on centralized servers, websites are distributed across a peer-to-peer network, making them censorship-resistant and always available. üåç‚ú®">
    <meta property="og:image" content="https://omodaka9375.github.io/portfolio/static/media/peerweb.7559ae56a756e1217679.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="peerweb.lol">
    <meta property="twitter:url" content="https://peerweb.lol/">
    <meta name="twitter:title" content=" PeerWeb - Decentralized Website Hosting">
    <meta name="twitter:description" content="PeerWeb is a revolutionary way to host and share websites using WebTorrent technology. Instead of relying on centralized servers, websites are distributed across a peer-to-peer network, making them censorship-resistant and always available. üåç‚ú®">
    <meta name="twitter:image" content="https://omodaka9375.github.io/portfolio/static/media/peerweb.7559ae56a756e1217679.png">

    <!-- Meta Tags Generated via https://www.opengraph.xyz -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%2210 0 100 100%22><text y=%22.90em%22 font-size=%2290%22>ü™ê</text></svg>"></link>
    
    <title> PeerWeb - Decentralized Website Hosting</title>
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(324deg, #66d4ea 0%, #504ba2 100%);
        min-height: 100vh;
    }

    .hero {
        text-align: center;
        padding: 2rem 0;
        color: white;
        background: rgba(0, 0, 0, 0.2);
    }

    .hero h1 {
        font-size: 3rem;
        margin-bottom: 0.5rem;
        margin-left: -35px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .hero h2 {
        font-size: 1.5rem;
        font-weight: 300;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: white;
        border-radius: 20px;
        margin-top: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    section {
        margin-bottom: 3rem;
    }

    h3 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
        color: #4a5568;
    }

    .steps, .req-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .step, .req {
        padding: 1rem;
        background: #f7fafc;
        border-radius: 10px;
        border-left: 4px solid #667eea;
    }

    .code-block {
        background: #2d3748;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 8px;
        font-family: 'Monaco', 'Consolas', monospace;
        overflow-x: auto;
        margin: 1rem 0;
    }

    .feature-grid, .benefit-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .feature, .benefit {
        padding: 1rem;
        background: #edf2f7;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .button-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 2rem;
    }

    #create-torrent{
        display: none;
    }

    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: #667eea;
        color: white;
    }

    .btn-primary:hover {
        background: #5a67d8;
        transform: translateY(-2px);
    }

    .btn-debug {
        background: #ed8936;
        color: white;
    }

    .btn-clear {
        background: #e53e3e;
        color: white;
    }

    .btn-create {
        background: #38a169;
        color: white;
    }

    .btn-back {
        background: #718096;
        color: white;
    }

    .btn-secondary {
        display: none;
        background: #edf2f7;
        color: #4a5568;
        border: 1px solid #e2e8f0;
    }

    .hash-input-group {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }

    .hash-input {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        min-width: 300px;
    }

    .hash-input:focus {
        outline: none;
        border-color: #667eea;
    }

    .debug-panel {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 400px;
        max-height: 300px;
        background: #2d3748;
        color: #e2e8f0;
        border-radius: 10px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 100000;
    }

    .debug-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #4a5568;
    }

    .debug-content {
        height: 200px;
        overflow-y: auto;
        padding: 1rem;
        font-family: 'Monaco', 'Consolas', monospace;
        font-size: 0.875rem;
    }

    .progress-container {
        margin: 1rem;
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #4a5568;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-bar::after {
        content: '';
        display: block;
        height: 100%;
        background: #667eea;
        width: 0%;
        transition: width 0.3s ease;
    }

    .progress-text {
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: #a0aec0;
    }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .loading-content {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        text-align: center;
        max-width: 400px;
        width: 90%;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .peer-stats {
        margin-top: 1rem;
        font-size: 0.875rem;
        color: #666;
    }

    .site-viewer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 1500;
    }

    .viewer-header {
        height: 60px;
        background: #f7fafc;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
    }

    .viewer-info {
        display: flex;
        gap: 1rem;
        font-size: 0.875rem;
        color: #666;
    }

    .site-frame {
        width: 100%;
        height: calc(100% - 60px);
        border: none;
    }

    .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3000;
    }

    .modal-content {
        background: white;
        border-radius: 15px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
        padding: 0.5rem;
    }

    .file-input {
        width: 100%;
        padding: 1rem;
        border: 2px dashed #e2e8f0;
        border-radius: 8px;
        margin: 1rem 0;
    }

    .file-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 1rem;
        margin: 1rem 0;
    }

    .torrent-result {
        margin-top: 2rem;
        padding: 1rem;
        background: #f0fff4;
        border-radius: 8px;
        border: 1px solid #9ae6b4;
    }

    .hidden {
        display: none !important;
    }

    footer {
        text-align: center;
        padding: 2rem;
        color: white;
        background: rgba(0, 0, 0, 0.2);
    }

    .tech-stack {
        font-size: 0.875rem;
        opacity: 0.8;
        margin-top: 0.5rem;
    }

    @media (max-width: 768px) {
        .hero h1 {
            font-size: 2rem;
        }
        
        .hero h2 {
            font-size: 1.2rem;
        }
        
        .container {
            margin: 1rem;
            padding: 1rem;
        }
        
        .feature-grid, .benefit-grid {
            grid-template-columns: 1fr;
        }
        
        .hash-input-group {
            flex-direction: column;
        }
        
        .hash-input {
            min-width: auto;
        }
        
        .debug-panel {
            width: calc(100% - 40px);
            bottom: 10px;
            right: 10px;
            left: 10px;
            z-index: 1000000;
        }
    }

    /* File List Container */
    .file-list-container {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        color: #333;
    }

    .file-list-container h4 {
        margin-bottom: 1rem;
        color: #4a5568;
    }

    .file-list {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        background: #f7fafc;
    }

    .file-item {
        padding: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .file-item:last-child {
        border-bottom: none;
    }

    .file-icon {
        font-size: 1.2rem;
        width: 20px;
        text-align: center;
    }

    .file-name {
        flex: 1;
        font-family: monospace;
        font-size: 0.875rem;
    }

    .file-size {
        color: #666;
        font-size: 0.75rem;
    }

    .file-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* Torrent Stats */
    .torrent-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
        padding: 1rem;
        background: #f7fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .stat-label {
        font-size: 0.75rem;
        color: #666;
        margin-bottom: 0.25rem;
    }

    .stat-item span:last-child {
        font-weight: bold;
        font-size: 1rem;
    }

    .status-seeding {
        color: #38a169;
    }

    .status-connecting {
        color: #ed8936;
    }

    .status-error {
        color: #e53e3e;
    }

    /* Hash and URL display */
    .hash-display,
    .url-display {
        display: block;
        word-break: break-all;
        max-width: 100%;
        overflow-wrap: break-word;
    }

    /* Result info improvements */
    .result-info {
        margin-bottom: 2rem;
    }

    .result-info p {
        margin-bottom: 1rem;
    }

    /* Responsive updates */
    @media (max-width: 768px) {
        .file-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .torrent-stats {
            grid-template-columns: 1fr;
        }
        
        .hash-display,
        .url-display {
            font-size: 0.75rem;
        }
    }

    /* Animation for file list */
    .file-item {
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Improved progress bars */
    .upload-progress-bar {
        background: linear-gradient(90deg, #667eea, #764ba2);
        transition: width 0.3s ease;
    }

    /* Better button styling */
    .file-actions .btn {
        min-width: 150px;
    }

    /* File type icons */
    .file-icon.html { color: #e34c26; }
    .file-icon.css { color: #1572b6; }
    .file-icon.js { color: #f7df1e; }
    .file-icon.image { color: #ff6b6b; }
    .file-icon.font { color: #4ecdc4; }
    .file-icon.other { color: #95a5a6; }


    /* Quick Upload Section */
    .quick-upload {
        margin-bottom: 3rem;
        padding: 2rem;
        background: linear-gradient(135deg, #66eacf 0%, #704ba2 100%);
        border-radius: 15px;
        color: white;
    }

    .quick-upload h3 {
        color: white;
        text-align: center;
        margin-bottom: 2rem;
    }

    .drop-zone {
        border: 3px dashed rgba(255, 255, 255, 0.5);
        border-radius: 15px;
        padding: 3rem;
        text-align: center;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.1);
        cursor: pointer;
    }

    .drop-zone.drag-over {
        border-color: #fff;
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.02);
    }

    .drop-content {
        pointer-events: none;
    }

    .drop-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: float 3s ease-in-out infinite;
    }

    .drop-content h4 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: white;
    }

    .drop-content p {
        margin-bottom: 2rem;
        opacity: 0.9;
    }

    .drop-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        pointer-events: all;
    }

    .upload-progress {
        margin-top: 2rem;
    }

    .upload-result {
        margin-top: 2rem;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        color: #333;
    }

    .result-success h4 {
        color: #38a169;
        margin-bottom: 1rem;
        text-align: center;
    }

    .result-info {
        margin-bottom: 2rem;
    }

    .result-info p {
        margin-bottom: 0.5rem;
    }

    .result-info code {
        background: #f7fafc;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.875rem;
        word-break: break-all;
        display: inline-block;
        max-width: 100%;
        overflow-wrap: break-word;
    }

    .result-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2rem;
    }

    .hosting-notice {
        margin-top: 2rem;
    }

    .notice-box {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 10px;
        padding: 1.5rem;
        color: #856404;
    }

    .notice-box h5 {
        margin-bottom: 1rem;
        color: #856404;
        font-size: 1.1rem;
    }

    .notice-box p {
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .desktop-clients {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 1rem;
    }

    .desktop-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-size: 0.875rem;
        transition: all 0.3s ease;
    }

    .desktop-link:hover {
        background: #5a67d8;
        transform: translateY(-2px);
    }

    /* Animations */
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .drop-zone.drag-over {
        animation: pulse 1s infinite;
    }

    .drop-zone:hover {
        border-color: rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.15);
    }

    /* Progress bar styling */
    .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .progress-bar::after {
        content: '';
        display: block;
        height: 100%;
        background: #38a169;
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 4px;
    }

    .progress-text {
        font-size: 0.875rem;
        opacity: 0.9;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .drop-zone {
            padding: 2rem 1rem;
        }
        
        .drop-buttons {
            flex-direction: column;
            align-items: center;
        }
        
        .result-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .desktop-clients {
            flex-direction: column;
            align-items: center;
        }
        
        .result-info code {
            font-size: 0.75rem;
        }
        
        .drop-icon {
            font-size: 3rem;
        }
        
        .drop-content h4 {
            font-size: 1.25rem;
        }
        
        .quick-upload {
            padding: 1.5rem;
        }
    }

    /* Enhanced button styles */
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
        min-width: 120px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn:active {
        transform: translateY(0);
    }

    .maintitle {
        text-decoration: none;
        color: #ddd;
    }

    /* Success animation */
    @keyframes success-bounce {
        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
        40% { transform: translateY(-10px); }
        60% { transform: translateY(-5px); }
    }

    .result-success h4 {
        animation: success-bounce 1s ease-in-out;
    }

    /* Loading states */
    .upload-progress .progress-text {
        text-align: center;
        color: rgba(255, 255, 255, 0.9);
    }

    /* File type indicators */
    .drop-zone::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .drop-zone:hover::before {
        opacity: 1;
    }
    </style>
</head>
<body>
    <div id="main-content">
        <header class="hero">
            <h1><a class="maintitle" href="https://github.com/Omodaka9375/peerweb" target="_blank">ü™ê PeerWeb</a></h1>
            <h2>Decentralized Website Hosting via WebTorrent</h2>
        </header>

        <main class="container">
            <section class="intro">
                <h3>ü§î What is PeerWeb?</h3>
                <p>PeerWeb is a revolutionary way to host and share websites using WebTorrent technology. Instead of relying on centralized servers, websites are distributed across a peer-to-peer network, making them censorship-resistant and always available. üåç‚ú®</p>
            </section>

            <!-- Quick Upload Section -->
            <section class="quick-upload">
                <h3>üì§ Quick Upload</h3>
                <div id="drop-zone" class="drop-zone">
                    <div class="drop-content">
                        <div class="drop-icon">üìÅ</div>
                        <h4>Drag & Drop Your Website</h4>
                        <p>Drop a folder with your website files</p>
                        <div class="drop-buttons">
                            <button id="select-folder" class="btn btn-primary">üìÅ Select Folder</button>
                            <!-- <button id="select-torrent" class="btn btn-secondary">üß≤ Select Torrent</button> -->
                        </div>
                    </div>
                    <div id="upload-progress" class="upload-progress hidden">
                        <div class="progress-container">
                            <div id="upload-progress-bar" class="progress-bar"></div>
                            <div id="upload-progress-text" class="progress-text">Processing files...</div>
                        </div>
                    </div>
                </div>
                
                <div id="upload-result" class="upload-result hidden">
                    <div class="result-success">
                        <h4>‚úÖ Website Ready!</h4>
                        <div class="result-info">
                            <p><strong>Hash:</strong> <code id="result-hash"></code></p>
                            <p><strong>PeerWeb URL:</strong> <code id="result-url"></code></p>
                        </div>
                        <div class="result-actions">
                            <button id="open-site" class="btn btn-primary">üöÄ Open Site</button>
                            <button id="copy-link" class="btn btn-secondary">üìã Copy Link</button>
                            <a id="download-torrent-file" class="btn btn-secondary" download>üíæ Download .torrent</a>
                        </div>
                        <div class="hosting-notice">
                            <div class="notice-box">
                                <h5>üåê Hosting Notice</h5>
                                <p><strong>Keep this PeerWeb tab open to host your site!</strong> As long as this tab remains open, your website will be available to others through the peer-to-peer network.</p>
                                <p>üí° <strong>Alternative:</strong> Download our desktop client for permanent hosting without keeping browser tabs open:</p>
                                <div class="desktop-clients">
                                    <a href="#" class="desktop-link" data-os="windows">ü™ü Windows</a>
                                    <a href="#" class="desktop-link" data-os="mac">üçé macOS</a>
                                    <a href="#" class="desktop-link" data-os="linux">üêß Linux</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="usage">
                <h3>üìö How to Use PeerWeb</h3>
                <div class="steps">
                    <div class="step">üé® Create your website - Build a static website with HTML, CSS, JavaScript, and assets</div>
                    <div class="step">üì¶ Upload via drag & drop - Simply drag your website folder to the upload area above</div>
                    <div class="step">üîó Share the link - Your site gets a unique PeerWeb link that works anywhere</div>
                    <div class="step">üåê Keep hosting - Leave this tab open or use our desktop client for permanent hosting</div>
                </div>
            </section>

            <section class="example">
                <h3>üí° Load Existing Site</h3>
                <p>To load a website from a torrent hash, enter it below:</p>
                <div class="hash-input-group">
                    <input type="text" id="hash-input" placeholder="Enter torrent hash..." class="hash-input">
                    <button id="load-site" class="btn btn-primary">Load Site</button>
                </div>
                <p>üéØ Just the hash! PeerWeb automatically adds the magnet link prefix and trackers.</p>
            </section>

            <section class="debug">
                <h3>üêõ Debug Mode</h3>
                <p>For developers and troubleshooting, add &debug=true to see detailed progress:</p>
                <div class="code-block">
                    <code>https://peerweb.lol?orc=ABC123DEF456...&debug=true</code>
                </div>
            </section>

            <section class="controls">
                <h3>üöÄ Advanced Options</h3>
                <div class="button-group">
                    <button id="debug-toggle" class="btn btn-debug">üêõ Enable Debug Mode</button>
                    <button id="clear-cache" class="btn btn-clear">üóëÔ∏è Clear Cache</button>
                    <button id="create-torrent" class="btn btn-create">üì¶ Advanced Torrent Creator</button>
                </div>
            </section>

            <section class="features">
                <h3>üíæ Smart Caching</h3>
                <p>PeerWeb caches visited sites for lightning-fast loading! üöÄ</p>
                <div class="feature-grid">
                    <div class="feature">üèÉ‚Äç‚ôÇÔ∏è Instant Loading - Cached sites load immediately</div>
                    <div class="feature">üíΩ IndexedDB Storage - Persistent across browser sessions</div>
                    <div class="feature">üßπ Auto Cleanup - Old cache expires after 7 days</div>
                    <div class="feature">üîí Secure Storage - Only cached after DOMPurify sanitization</div>
                </div>
                <br><br>
                <h3>üõ°Ô∏è Security Features</h3>
                <p>Enhanced security with DOMPurify integration! üîí</p>
                <div class="feature-grid">
                    <div class="feature">üßº XSS Protection - All HTML sanitized with DOMPurify</div>
                    <div class="feature">üö´ Malicious Code Removal - Dangerous tags and attributes filtered</div>
                    <div class="feature">üì¶ Sandboxed Execution - Sites run in isolated iframe environment</div>
                    <div class="feature">üîç Content Validation - All resources validated before display</div>
                </div>
            </section>

            <section class="requirements">
                <h3>üìã Requirements for PeerWeb Sites</h3>
                <div class="req-list">
                    <div class="req">üìÑ Must contain an index.html file (in root or subfolder)</div>
                    <div class="req">üîó All resources should use relative paths</div>
                    <div class="req">‚ö° Only static content (HTML, CSS, JS, images, fonts, etc.)</div>
                    <div class="req">üîí Files are served in a sandboxed environment for security</div>
                    <div class="req">üì± Responsive design recommended for best experience</div>
                    <div class="req">üßπ Content is automatically sanitized for security</div>
                </div>
            </section>

            <section class="benefits">
                <h3>‚ú® Benefits</h3>
                <div class="benefit-grid">
                    <div class="benefit">üö´ Censorship Resistant - No central point of failure</div>
                    <div class="benefit">üí∞ Cost Effective - No hosting fees ever</div>
                    <div class="benefit">üåç Global Distribution - Automatically distributed worldwide</div>
                    <div class="benefit">üì± Always Available - Works as long as peers are online</div>
                    <div class="benefit">üîí Secure - Sandboxed execution with XSS protection</div>
                    <div class="benefit">üìä Real-time Progress - See download progress and peer statistics</div>
                    <div class="benefit">‚ö° Fast Loading - Smart caching for instant repeat visits</div>
                    <div class="benefit">üéØ Simple URLs - Just add the torrent hash to any PeerWeb site</div>
                    <div class="benefit">üíæ Offline Ready - Cached sites work without internet</div>
                </div>
            </section>

        </main>

        <footer>
            <p>üåü Made with ‚ù§Ô∏è for the decentralized web üåü</p>
            <p class="tech-stack">Powered by WebTorrent Protocol ‚Ä¢ Secured by DOMPurify & Sandboxing ‚Ä¢ Cached with IndexedDB</p>
        </footer>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="folder-input" webkitdirectory style="display: none;">
    <input type="file" id="torrent-input" accept=".torrent" style="display: none;">

    <!-- Debug Panel -->
    <div id="debug-panel" class="debug-panel hidden">
        <div class="debug-header">
            <h4>üêõ Debug Console</h4>
            <button id="close-debug" class="close-btn">√ó</button>
        </div>
        <div id="debug-content" class="debug-content"></div>
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
            <div id="progress-text" class="progress-text">Ready...</div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Loading PeerWeb Site...</h3>
            <div id="loading-progress" class="progress-container">
                <div id="loading-progress-bar" class="progress-bar"></div>
                <div id="loading-progress-text" class="progress-text">Connecting to peers...</div>
            </div>
            <div id="peer-stats" class="peer-stats"></div>
        </div>
    </div>

    <!-- Site Viewer -->
    <div id="site-viewer" class="site-viewer hidden">
        <!-- <div class="viewer-header">
            <button id="back-to-peerweb" class="btn btn-back">‚Üê Back to PeerWeb</button>
            <div class="viewer-info">
                <span id="current-hash"></span>
                <span id="cache-status"></span>
            </div>
        </div> -->
        <iframe id="site-frame" class="site-frame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
    </div>

    <!-- Torrent Creator Modal -->
    <div id="torrent-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üì¶ Advanced Torrent Creator</h3>
                <button id="close-modal" class="close-btn">√ó</button>
            </div>
            <div class="modal-body">
                <p>Select your website files to create a torrent:</p>
                <input type="file" id="file-input" multiple webkitdirectory class="file-input">
                <div id="file-list" class="file-list"></div>
                <button id="create-torrent-btn" class="btn btn-primary" disabled>Create Torrent</button>
                <div id="torrent-result" class="torrent-result hidden">
                    <h4>‚úÖ Torrent Created!</h4>
                    <p>Hash: <code id="created-hash"></code></p>
                    <p>URL: <code id="created-url"></code></p>
                    <button id="copy-url" class="btn btn-secondary">Copy URL</button>
                    <a id="download-torrent" class="btn btn-secondary" download="website.torrent">Download .torrent</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        class PeerWeb{constructor(){this.client=null,this.debug=!1,this.cache=new PeerWebCache,this.currentSiteData=null,this.currentHash=null,this.serviceWorkerReady=!1,this.clientReady=!1,this.librariesLoaded=!1,this.trackers=["wss://tracker.btorrent.xyz","wss://tracker.openwebtorrent.com","udp://tracker.leechers-paradise.org:6969","udp://tracker.coppersurfer.tk:6969","udp://tracker.opentrackr.org:1337","udp://explodie.org:6969","udp://tracker.empire-js.us:1337"],this.init()}async init(){try{await this.loadRequiredLibraries(),await this.initializeWebTorrent(),await this.registerServiceWorker(),this.setupEventListeners(),this.checkURL(),this.updateDebugToggle()}catch(e){console.error("PeerWeb initialization failed:",e),this.showError("Failed to initialize PeerWeb: "+e.message)}}async loadRequiredLibraries(){if(this.log("Loading required libraries..."),"undefined"==typeof WebTorrent&&(await this.loadScript("https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"),this.log("WebTorrent library loaded")),"undefined"==typeof DOMPurify&&(await this.loadScript("https://cdn.jsdelivr.net/npm/dompurify@2.4.7/dist/purify.min.js"),this.log("DOMPurify library loaded")),"undefined"==typeof WebTorrent)throw new Error("Failed to load WebTorrent library");if("undefined"==typeof DOMPurify)throw new Error("Failed to load DOMPurify library");this.librariesLoaded=!0,this.log("All required libraries loaded successfully")}loadScript(e){return new Promise(((t,r)=>{if(document.querySelector(`script[src="${e}"]`))return void t();const o=document.createElement("script");o.src=e,o.async=!0,o.onload=()=>{this.log(`Script loaded: ${e}`),t()},o.onerror=t=>{this.log(`Failed to load script: ${e}`),r(new Error(`Failed to load script: ${e}`))},document.head.appendChild(o),setTimeout((()=>{o.onload.called||r(new Error(`Script load timeout: ${e}`))}),1e4)}))}async initializeWebTorrent(){if(!this.librariesLoaded)throw new Error("Libraries not loaded yet");return new Promise((e=>{try{this.client=new WebTorrent,this.client.on("error",(e=>{this.log("WebTorrent error: "+e.message),console.error("WebTorrent error:",e)})),this.client.on("ready",(()=>{this.clientReady=!0,this.log("WebTorrent client ready"),e()})),setTimeout((()=>{this.clientReady||(this.clientReady=!0,this.log("WebTorrent client ready (timeout fallback)"),e())}),2e3)}catch(t){this.log("Error initializing WebTorrent: "+t.message),console.error("WebTorrent initialization error:",t),this.client={add:()=>console.error("WebTorrent not available"),seed:()=>console.error("WebTorrent not available")},e()}}))}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistrations();for(let t of e)await t.unregister(),this.log("Unregistered existing service worker");const t=await navigator.serviceWorker.register("./peerweb-sw.js",{scope:"/"});this.log("Service Worker registered successfully"),await navigator.serviceWorker.ready,this.serviceWorkerReady=!0,this.log("Service Worker is ready"),navigator.serviceWorker.addEventListener("message",(e=>{this.log(`SW Message: ${e.data.type}`),"RESOURCE_REQUEST"===e.data.type&&this.handleServiceWorkerResourceRequest(e.data.url,e.data.requestId,e.data.filePath)})),t.waiting&&t.waiting.postMessage({type:"SKIP_WAITING"})}catch(e){this.log("Service Worker registration failed: "+e.message),console.error("SW Error:",e)}else this.log("Service Workers not supported")}handleServiceWorkerResourceRequest(e,t,r=null){if(this.log(`SW requesting: ${e} (ID: ${t})`),!this.currentSiteData)return this.log("No site data available"),void this.sendToServiceWorker("RESOURCE_RESPONSE",{requestId:t,url:e,data:null});let o=r;if(!o){o=new URL(e).pathname.split("/").slice(3).join("/"),o&&""!==o||(o="index.html")}this.log(`Looking for file: "${o}"`);const i=this.findFileInSiteData(o);if(i){this.log(`Found file: ${o} (${i.size} bytes, ${i.type})`);const r=Array.from(new Uint8Array(i.content));this.sendToServiceWorker("RESOURCE_RESPONSE",{requestId:t,url:e,data:r,contentType:i.type})}else this.log(`File not found: ${o}`),this.log(`Available files: ${Object.keys(this.currentSiteData).join(", ")}`),this.sendToServiceWorker("RESOURCE_RESPONSE",{requestId:t,url:e,data:null})}sendToServiceWorker(e,t){navigator.serviceWorker.controller?(navigator.serviceWorker.controller.postMessage({type:e,...t}),this.log(`Sent to SW: ${e}`)):this.log("No SW controller available")}findFileInSiteData(e){if(!this.currentSiteData)return null;this.log(`Searching for: "${e}"`);let t=e;t.startsWith("./")&&(t=t.substring(2)),t.startsWith("/")&&(t=t.substring(1));const r=[e,t];for(const e of r)if(this.currentSiteData[e])return this.log(`Exact match: ${e}`),this.currentSiteData[e];const o=Object.keys(this.currentSiteData);this.log(`All available files: ${o.join(", ")}`);const i=t.split("/").pop();for(const e of o){if(e.split("/").pop()===i)return this.log(`Filename match: ${e}`),this.currentSiteData[e]}for(const e of o)if(e.endsWith(t)||t.endsWith(e))return this.log(`Partial match: ${e}`),this.currentSiteData[e];return null}setupEventListeners(){const e=document.getElementById("debug-toggle");e&&e.addEventListener("click",(()=>{this.toggleDebug()}));const t=document.getElementById("clear-cache");t&&t.addEventListener("click",(()=>{this.clearCache()}));const r=document.getElementById("create-torrent");r&&r.addEventListener("click",(()=>{this.showTorrentModal()}));const o=document.getElementById("load-site");o&&o.addEventListener("click",(()=>{const e=document.getElementById("hash-input").value.trim();e&&this.loadSite(e)}));const i=document.getElementById("hash-input");i&&i.addEventListener("keypress",(e=>{if("Enter"===e.key){const t=e.target.value.trim();t&&this.loadSite(t)}}));const s=document.getElementById("back-to-peerweb");s&&s.addEventListener("click",(()=>{this.showMainContent()}));const n=document.getElementById("close-debug");n&&n.addEventListener("click",(()=>{document.getElementById("debug-panel").classList.add("hidden")}));const a=document.getElementById("close-modal");a&&a.addEventListener("click",(()=>{this.hideTorrentModal()}));const l=document.getElementById("file-input");l&&l.addEventListener("change",(e=>{this.handleFileSelection(e)}));const d=document.getElementById("create-torrent-btn");d&&d.addEventListener("click",(()=>{this.createTorrent()}));const c=document.getElementById("copy-url");c&&c.addEventListener("click",(()=>{const e=document.getElementById("created-url").textContent;navigator.clipboard.writeText(e),alert("URL copied to clipboard!")})),this.setupDragAndDrop(),this.setupQuickUpload()}setupDragAndDrop(){const e=document.getElementById("drop-zone"),t=document.getElementById("folder-input"),r=document.getElementById("torrent-input");if(!e)return;["dragenter","dragover","dragleave","drop"].forEach((t=>{e.addEventListener(t,(e=>{e.preventDefault(),e.stopPropagation()}))})),["dragenter","dragover"].forEach((t=>{e.addEventListener(t,(()=>{e.classList.add("drag-over")}))})),["dragleave","drop"].forEach((t=>{e.addEventListener(t,(()=>{e.classList.remove("drag-over")}))})),e.addEventListener("drop",(e=>{const t=Array.from(e.dataTransfer.files);this.handleDroppedFiles(t)}));const o=document.getElementById("select-folder");o&&t&&o.addEventListener("click",(()=>{t.click()}));const i=document.getElementById("select-torrent");i&&r&&i.addEventListener("click",(()=>{r.click()})),t&&t.addEventListener("change",(e=>{const t=Array.from(e.target.files);this.handleDroppedFiles(t)})),r&&r.addEventListener("change",(e=>{const t=Array.from(e.target.files);this.handleDroppedFiles(t)}))}setupQuickUpload(){const e=document.getElementById("open-site");e&&e.addEventListener("click",(()=>{const e=document.getElementById("result-hash").textContent,t=`${window.location.origin}${window.location.pathname}?orc=${e}`;window.open(t,"_blank")}));const t=document.getElementById("copy-link");t&&t.addEventListener("click",(()=>{const e=document.getElementById("result-url").textContent;navigator.clipboard.writeText(e).then((()=>{const e=document.getElementById("copy-link"),t=e.textContent;e.textContent="‚úÖ Copied!",setTimeout((()=>{e.textContent=t}),2e3)}))})),document.querySelectorAll(".desktop-link").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.dataset.os;this.downloadDesktopClient(t)}))}))}handleDroppedFiles(e){if(0===e.length)return;if(this.log(`Dropped ${e.length} files`),!this.clientReady||!this.client)return this.log("WebTorrent client not ready, waiting..."),this.showUploadProgress("WebTorrent client is loading..."),void setTimeout((()=>{this.hideUploadProgress(),this.handleDroppedFiles(e)}),1e3);const t=e.filter((e=>e.name.toLowerCase().endsWith(".torrent")&&"application/x-bittorrent"===e.type));if(0!==t.length)return this.log(`Found ${t.length} .torrent files (by MIME type)`),void this.handleTorrentFile(t[0]);{const t=e.filter((e=>e.name.toLowerCase().endsWith(".torrent")));if(t.length>0)return this.log(`Found ${t.length} .torrent files (by extension)`),void this.handleTorrentFile(t[0])}if(e.length>1)return void this.handleFolderUpload(e);const r=e[0];if(!r.name.toLowerCase().endsWith(".html"))return 1===e.length&&r.size<1048576?(this.log("Single small file detected, checking if it's a torrent..."),void this.readFileAsArrayBuffer(r).then((e=>{this.isValidTorrentBuffer(e)?(this.log("File appears to be a torrent despite extension"),this.handleTorrentFile(r)):alert("Please drop a website folder or a valid .torrent file")})).catch((e=>{this.log(`Error checking file: ${e.message}`),alert("Please drop a website folder or a .torrent file")}))):void alert("Please drop a website folder or a .torrent file");this.handleFolderUpload(e)}async handleTorrentFile(e){if(this.log(`Loading torrent file: ${e.name} (${e.size} bytes)`),this.clientReady&&this.client){this.showUploadProgress("Reading torrent file...");try{const t=await this.readFileAsArrayBuffer(e);if(this.log(`Torrent file read: ${t.byteLength} bytes`),!this.isValidTorrentBuffer(t))throw new Error("Invalid torrent file format");this.log("Torrent file validation passed, adding to WebTorrent..."),this.addTorrentWithFallback(t,e)}catch(e){this.log(`Error loading torrent: ${e.message}`),console.error("Torrent loading error:",e),this.hideUploadProgress(),e.message.includes("Invalid torrent identifier")?alert("Invalid torrent file. The file may be corrupted or incompatible with WebTorrent.\n\nTry creating a new torrent with the Advanced Torrent Creator."):e.message.includes("Invalid torrent file format")?alert("This doesn't appear to be a valid torrent file. Please check the file and try again."):alert("Error loading torrent file: "+e.message+"\n\nPlease try creating a new torrent or check if the file is valid.")}}else alert("WebTorrent client not ready. Please wait a moment and try again.")}addTorrentWithFallback(e,t){let r=0;const o=(i,s)=>{r++,this.log(`Attempt ${r}: Trying to add torrent using ${s}`);try{this.client.add(i,{announce:this.trackers,path:"/tmp/webtorrent/"},(t=>{this.log(`Torrent loaded successfully with ${s}: ${t.infoHash}`),this.log(`Torrent name: ${t.name||"Unknown"}`),this.log(`Number of files: ${t.files.length}`),t.files.forEach(((e,t)=>{this.log(`File ${t+1}: ${e.name} (${e.length} bytes)`)})),this.showUploadResult(t.infoHash,e,t),this.hideUploadProgress(),t.files.forEach((e=>e.select())),this.log(`Started downloading ${t.files.length} files`)}))}catch(i){if(this.log(`Failed with ${s}: ${i.message}`),!(r<3))throw this.hideUploadProgress(),new Error(`All methods failed. Last error: ${i.message}`);if(1===r){const t=new Uint8Array(e);o(t,"Uint8Array")}else 2===r&&this.tryBlobMethod(t)}};o(e,"ArrayBuffer")}async tryBlobMethod(e){try{this.log("Trying blob method...");const t=new Blob([e],{type:"application/x-bittorrent"}),r=new FileReader;r.onload=e=>{try{const t=e.target.result,r=new Uint8Array(t);this.log(`Blob method: read ${r.length} bytes`),this.client.add(r,{announce:this.trackers},(e=>{this.log(`Torrent loaded successfully with blob method: ${e.infoHash}`),this.showUploadResult(e.infoHash,t,e),this.hideUploadProgress(),e.files.forEach((e=>e.select()))}))}catch(e){throw this.log(`Blob method failed: ${e.message}`),this.hideUploadProgress(),e}},r.onerror=()=>{throw this.log("Blob method: FileReader error"),this.hideUploadProgress(),new Error("Failed to read file with blob method")},r.readAsArrayBuffer(t)}catch(e){throw this.log(`Blob method error: ${e.message}`),this.hideUploadProgress(),e}}isValidTorrentBuffer(e){try{const t=new Uint8Array(e);if(this.log(`Validating torrent buffer: ${t.length} bytes`),t.length<50)return this.log("Torrent file too small"),!1;if(100!==t[0])return this.log(`Invalid start byte: 0x${t[0].toString(16)} (expected 0x64 for 'd')`),!1;101!==t[t.length-1]&&this.log(`Invalid end byte: 0x${t[t.length-1].toString(16)} (expected 0x65 for 'e')`);const r=new TextDecoder("utf-8",{fatal:!1}).decode(t);this.log(`Torrent content preview: ${r.substring(0,200)}`);const o=r.includes("announce")||this.findBencodedString(t,"announce"),i=r.includes("info")||this.findBencodedString(t,"info");if(this.log(`Torrent validation - announce: ${o}, info: ${i}`),!o||!i)return this.log("Missing required torrent fields (announce or info)"),!1;const s=r.includes("piece length")||this.findBencodedString(t,"piece length"),n=r.includes("pieces")||this.findBencodedString(t,"pieces");return this.log(`Additional validation - piece length: ${s}, pieces: ${n}`),this.log("Torrent file validation passed"),!0}catch(e){return this.log(`Torrent validation error: ${e.message}`),!1}}findBencodedString(e,t){try{const r=(new TextEncoder).encode(`${t.length}:${t}`);for(let t=0;t<=e.length-r.length;t++){let o=!0;for(let i=0;i<r.length;i++)if(e[t+i]!==r[i]){o=!1;break}if(o)return!0}return!1}catch(e){return!1}}readFileAsArrayBuffer(e){return new Promise(((t,r)=>{if(!(e&&e instanceof File))return void r(new Error("Invalid file object"));this.log(`Reading file: ${e.name}, size: ${e.size}, type: ${e.type}`);const o=new FileReader;o.onload=e=>{const o=e.target.result;o&&o.byteLength>0?(this.log(`File read successfully: ${o.byteLength} bytes`),t(o)):r(new Error("File reading returned empty result"))},o.onerror=()=>{const e=o.error||new Error("Unknown FileReader error");this.log(`FileReader error: ${e.message}`),r(new Error("File reading failed: "+e.message))},o.onabort=()=>{this.log("FileReader aborted"),r(new Error("File reading was aborted"))},o.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*100);this.log(`Reading file: ${t}%`)}};try{o.readAsArrayBuffer(e)}catch(e){this.log(`Failed to start file reading: ${e.message}`),r(new Error("Failed to start file reading: "+e.message))}}))}async handleFolderUpload(e){if(this.log(`Processing ${e.length} files for upload`),!this.clientReady||!this.client)return void alert("WebTorrent client not ready. Please wait a moment and try again.");if(e.some((e=>(e.webkitRelativePath||e.name).toLowerCase().includes("index.html")))||confirm("No index.html found. Continue anyway? (Site may not load properly)")){this.showUploadProgress("Creating torrent...");try{this.client.seed(e,{announce:this.trackers,name:this.generateTorrentName(e),comment:"Created with PeerWeb - Decentralized Website Hosting",createdBy:"PeerWeb v1.0",private:!1,pieceLength:this.calculateOptimalPieceLength(e)},(e=>{this.log(`Torrent created: ${e.infoHash}`),this.log(`Torrent name: ${e.name}`),this.showUploadResult(e.infoHash,e.torrentFile,e),this.hideUploadProgress()}))}catch(e){this.log(`Error creating torrent: ${e.message}`),console.error("Seeding error:",e),this.hideUploadProgress(),alert("Error creating torrent: "+e.message)}}}showUploadProgress(e){const t=document.getElementById("upload-progress"),r=document.getElementById("upload-progress-text"),o=document.getElementById("upload-result");t&&t.classList.remove("hidden"),r&&(r.textContent=e),o&&o.classList.add("hidden")}hideUploadProgress(){const e=document.getElementById("upload-progress");e&&e.classList.add("hidden")}showUploadResult(e,t,r){const o=`${window.location.origin}${window.location.pathname}?orc=${e}`,i=document.getElementById("result-hash"),s=document.getElementById("result-url"),n=document.getElementById("upload-result");if(i&&(i.textContent=e),s&&(s.textContent=o),t){const r=document.getElementById("download-torrent-file");r&&(r.href=URL.createObjectURL(new Blob([t])),r.download=`website-${e.substring(0,8)}.torrent`,r.style.display="inline-flex")}else{const e=document.getElementById("download-torrent-file");e&&(e.style.display="none")}n&&n.classList.remove("hidden"),r&&this.updateSeedingStats(r)}updateSeedingStats(e){e.on("upload",(()=>{this.log(`Uploaded: ${this.formatBytes(e.uploaded)} to ${e.numPeers} peers`)}))}downloadDesktopClient(e){const t={windows:"https://github.com/peerweb/peerweb-desktop/releases/download/v1.0.0/PeerWeb-Setup-1.0.0.exe",mac:"https://github.com/peerweb/peerweb-desktop/releases/download/v1.0.0/PeerWeb-1.0.0.dmg",linux:"https://github.com/peerweb/peerweb-desktop/releases/download/v1.0.0/PeerWeb-1.0.0.AppImage"}[e];t?(window.open(t,"_blank"),this.log(`Opened desktop client download for ${e}`)):alert("Desktop client for "+e+" is coming soon!")}readFileAsArrayBuffer(e){return new Promise(((t,r)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=r,o.readAsArrayBuffer(e)}))}checkURL(){const e=new URLSearchParams(window.location.search),t=e.get("orc");if("true"===e.get("debug")&&(this.debug=!0,this.updateDebugToggle(),this.showDebugPanel()),t){const e=()=>{this.serviceWorkerReady&&this.clientReady&&this.librariesLoaded?this.loadSite(t):setTimeout(e,500)};e()}}async loadSite(e){if(this.log(`Loading site with hash: ${e}`),!this.serviceWorkerReady)return this.log("Service worker not ready, waiting..."),void setTimeout((()=>this.loadSite(e)),500);if(!this.clientReady||!this.client)return this.log("WebTorrent client not ready, waiting..."),void setTimeout((()=>this.loadSite(e)),500);if(!this.isValidTorrentHash(e))return void alert("Invalid torrent hash format. Please check the hash and try again.");this.currentHash=e;const t=await this.cache.get(e);if(t)return this.log("Loading from cache..."),void this.displayCachedSite(t,e);this.showLoadingOverlay();const r=`magnet:?xt=urn:btih:${e}&tr=${this.trackers.join("&tr=")}`;this.log(`Magnet URI: ${r}`);try{this.client.add(r,(async t=>{this.log(`Torrent added: ${t.name||"Unknown"}`),this.updatePeerStats(t);let r=!1,o=null;t.on("download",(()=>{this.updateProgress(t),this.updatePeerStats(t),!r&&this.shouldProcessSiteEarly(t)&&(this.log("Sufficient data downloaded, processing site early..."),r=!0,o&&(clearTimeout(o),o=null),this.processTorrentEarly(t,e))})),t.on("done",(async()=>{this.log("Download completed (100%)!"),r||(r=!0,o&&(clearTimeout(o),o=null),await this.processTorrent(t,e))})),t.on("error",(e=>{this.log(`Torrent error: ${e.message}`),this.hideLoadingOverlay(),alert("Error loading torrent: "+e.message)})),t.files.forEach((e=>e.select())),this.log(`Selected ${t.files.length} files for download`);const i=this.findIndexFile(t.files);if(!i)return this.log("No index.html found!"),this.hideLoadingOverlay(),void alert("No index.html file found in torrent!");this.log(`Found index file: ${i.name}`),o=setTimeout((()=>{!r&&t.progress>.8&&(this.log("Processing site due to timeout (80%+ downloaded)"),r=!0,this.processTorrentEarly(t,e))}),15e3)}))}catch(e){this.log(`Error adding torrent: ${e.message}`),this.hideLoadingOverlay(),alert("Error loading torrent: "+e.message)}}isValidTorrentHash(e){if(!e||"string"!=typeof e)return!1;if(40!==(e=e.trim()).length)return this.log(`Invalid hash length: ${e.length}, expected 40`),!1;return!!/^[a-fA-F0-9]+$/.test(e)||(this.log("Hash contains non-hexadecimal characters"),!1)}shouldProcessSiteEarly(e){if(e.progress>=.95)return this.log(`Progress at ${Math.round(100*e.progress)}%, processing early`),!0;return!(!this.findIndexFile(e.files)||!this.hasEssentialFiles(e))&&(this.log("Essential files available, processing early"),!0)}hasEssentialFiles(e){let t=0,r=e.files.length;e.files.forEach((e=>{e.progress>=.9&&t++}));const o=t/r;return this.log(`File availability: ${t}/${r} (${Math.round(100*o)}%)`),o>=.8}async processTorrentEarly(e,t){this.log("Processing torrent early (before 100% completion)");const r={};let o=0,i=0;const s=e.files.sort(((e,t)=>{const r=this.isMediaFile(e.name),o=this.isMediaFile(t.name),i=e.name.toLowerCase().includes("index.html")||e.name.toLowerCase().endsWith(".css")||e.name.toLowerCase().endsWith(".js"),s=t.name.toLowerCase().includes("index.html")||t.name.toLowerCase().endsWith(".css")||t.name.toLowerCase().endsWith(".js");return i&&!s?-1:!i&&s||r&&!o?1:!r&&o?-1:0}));this.log(`Processing ${s.length} files (early processing)...`);for(const e of s)try{const t=this.isMediaFile(e.name),i=e.name.toLowerCase().includes("index.html")||e.name.toLowerCase().endsWith(".css");let s=.8;if(i?s=.9:t&&(s=.7),this.log(`Processing file: ${e.name} (${Math.round(100*e.progress)}% complete, need ${Math.round(100*s)}%)`),e.progress<s){if(!t){this.log(`Skipping ${e.name} - only ${Math.round(100*e.progress)}% downloaded`);continue}this.log(`Processing media file early: ${e.name}`)}const n=t?1e4:5e3,a=await this.getFileBufferWithTimeout(e,n);r[e.name]={content:a,type:this.getContentType(e.name),isText:this.isTextFile(e.name),isMedia:t,size:a.length},o++,this.log(`Processed ${e.name} (${a.length} bytes, ${r[e.name].type})`)}catch(t){if(i++,this.log(`Failed to process file ${e.name}: ${t.message}`),e.name.toLowerCase().includes("index.html"))try{this.log(`Retrying critical file: ${e.name}`),await new Promise((e=>setTimeout(e,2e3)));const t=await this.getFileBufferWithTimeout(e,15e3);r[e.name]={content:t,type:this.getContentType(e.name),isText:this.isTextFile(e.name),isMedia:!1,size:t.length},o++,this.log(`Successfully processed ${e.name} on retry`)}catch(t){this.log(`Failed to process critical file ${e.name} even on retry: ${t.message}`)}}if(this.log(`Processing complete: ${o} files processed, ${i} files failed`),0===o)return void this.log("No files were processed successfully, waiting for more download progress...");Object.keys(r).some((e=>e.toLowerCase().includes("index.html")))?(this.log(`Successfully processed ${Object.keys(r).length} files with index.html present`),await this.cache.set(t,r),this.displaySite(r,t),this.hideLoadingOverlay()):this.log("No index.html found in processed files, waiting for more download progress...")}isMediaFile(e){return[".mp4",".webm",".avi",".mov",".wmv",".flv",".mkv",".mp3",".wav",".ogg",".aac",".flac",".m4a",".gif"].some((t=>e.toLowerCase().endsWith(t)))}getContentType(e){return{html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",mjs:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",ico:"image/x-icon",woff:"font/woff",woff2:"font/woff2",ttf:"font/ttf",otf:"font/otf",eot:"application/vnd.ms-fontobject",mp4:"video/mp4",webm:"video/webm",avi:"video/avi",mov:"video/quicktime",wmv:"video/x-ms-wmv",flv:"video/x-flv",mkv:"video/x-matroska",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",aac:"audio/aac",flac:"audio/flac",m4a:"audio/mp4",pdf:"application/pdf"}[e.toLowerCase().split(".").pop()]||"application/octet-stream"}getFileBufferWithTimeout(e,t=5e3){return new Promise(((r,o)=>{const i=setTimeout((()=>{o(new Error(`File buffer timeout after ${t}ms`))}),t);e.getBuffer(((e,t)=>{clearTimeout(i),e?o(e):r(t)}))}))}findIndexFile(e){return e.find((e=>{const t=e.name.toLowerCase();return"index.html"===t||t.endsWith("/index.html")}))}async processTorrent(e,t){const r={},o=e.files;this.log(`Processing ${o.length} files...`);for(const e of o)try{this.log(`Processing file: ${e.name}`);const t=await this.getFileBuffer(e);r[e.name]={content:t,type:this.getContentType(e.name),isText:this.isTextFile(e.name),size:t.length},this.log(`Processed ${e.name} (${t.length} bytes, ${r[e.name].type})`)}catch(t){this.log(`Error processing file ${e.name}: ${t.message}`)}this.log(`Successfully processed ${Object.keys(r).length} files`),this.log(`File list: ${Object.keys(r).join(", ")}`),await this.cache.set(t,r),this.displaySite(r,t),this.hideLoadingOverlay()}async displayCachedSite(e,t){this.displaySite(e,t,!0)}displaySite(e,t,r=!1){this.log(`Displaying site with ${Object.keys(e).length} files`),this.log(`Files: ${Object.keys(e).join(", ")}`),this.currentSiteData=e,this.currentHash=t,this.sendToServiceWorker("SITE_READY",{hash:t,fileCount:Object.keys(e).length,fileList:Object.keys(e)});const o=Object.keys(e).find((e=>{const t=e.toLowerCase();return"index.html"===t||t.endsWith("/index.html")}));if(!o)return void alert("No index.html found!");this.log(`Found index file: ${o}`);const i=e[o];let s=(new TextDecoder).decode(i.content);this.log("Processing HTML content..."),s=this.processHtmlForPeerWeb(s,e,o,t),s=this.sanitizeHtml(s),this.log("HTML content processed and sanitized");const n=new Blob([s],{type:"text/html"}),a=(URL.createObjectURL(n),`${window.location.origin}/peerweb-site/${t}/`);this.log(`Site URL: ${a}`),setTimeout((()=>{this.showSiteViewer(a,t,r)}),100)}processHtmlForPeerWeb(e,t,r,o){this.log("Processing HTML for PeerWeb...");const i=(new DOMParser).parseFromString(e,"text/html"),s=r.includes("/")?r.substring(0,r.lastIndexOf("/")+1):"";[{selector:"link[href]",attr:"href"},{selector:"script[src]",attr:"src"},{selector:"img[src]",attr:"src"},{selector:"source[src]",attr:"src"},{selector:"source[srcset]",attr:"srcset"},{selector:"img[srcset]",attr:"srcset"},{selector:"video[src]",attr:"src"},{selector:"audio[src]",attr:"src"},{selector:"embed[src]",attr:"src"},{selector:"object[data]",attr:"data"}].forEach((({selector:e,attr:t})=>{const r=i.querySelectorAll(e);this.log(`Processing ${r.length} elements with selector: ${e}`),r.forEach((e=>{const r=e.getAttribute(t);if(r&&this.isInternalResource(r)){const i=this.convertToVirtualUrl(r,s,o);i?(e.setAttribute(t,i),this.log(`Converted internal resource: ${r} -> ${i}`)):this.log(`Could not convert internal resource: ${r}`)}else r&&this.log(`Preserving external resource: ${r}`)}))}));const n=i.querySelectorAll("a[href]");this.log(`Processing ${n.length} navigation links`),n.forEach((e=>{const t=e.getAttribute("href");if(t&&this.isInternalNavigation(t)){const r=this.convertNavigationToVirtualUrl(t,s,o);r&&(e.setAttribute("href",r),this.log(`Converted internal navigation: ${t} -> ${r}`))}else t&&this.log(`Preserving external link: ${t}`)}));return i.querySelectorAll("style").forEach((e=>{const t=e.textContent,r=this.processCssContent(t,s,o);e.textContent=r})),i.documentElement.outerHTML}isInternalResource(e){return!!e&&(!e.startsWith("http://")&&!e.startsWith("https://")&&(!e.startsWith("data:")&&(!e.startsWith("blob:")&&(!e.startsWith("//")&&!(e.includes(":")&&!e.startsWith("./")&&!e.startsWith("../"))))))}isInternalNavigation(e){return!!e&&(!!e.startsWith("#")||!e.startsWith("http://")&&!e.startsWith("https://")&&(!e.startsWith("//")&&(!e.startsWith("mailto:")&&(!e.startsWith("tel:")&&!(e.includes(":")&&!e.startsWith("./")&&!e.startsWith("../"))))))}convertToVirtualUrl(e,t,r){let o=e.split("?")[0].split("#")[0];return o.startsWith("./")&&(o=o.substring(2)),o=o.startsWith("../")?this.resolveParentPath(t,o):o.startsWith("/")?o.substring(1):t+o,`/peerweb-site/${r}/${o}`}convertNavigationToVirtualUrl(e,t,r){return e.startsWith("#")?e:this.convertToVirtualUrl(e,t,r)}processCssContent(e,t,r){return e=(e=e.replace(/@import\s+['"]([^'"]+)['"]/g,((e,o)=>{if(this.isInternalResource(o)){const i=this.convertToVirtualUrl(o,t,r);return i?`@import "${i}"`:e}return e}))).replace(/url\(['"]?([^'")\s]+)['"]?\)/g,((e,o)=>{if(this.isInternalResource(o)){const i=this.convertToVirtualUrl(o,t,r);return i?`url("${i}")`:e}return e}))}resolveParentPath(e,t){const r=e.split("/").filter(Boolean),o=t.split("/");for(const e of o)".."===e?r.pop():"."!==e&&r.push(e);return r.join("/")}sanitizeHtml(e){return DOMPurify.sanitize(e,{ADD_TAGS:["link","style","script"],ADD_ATTR:["href","src","type","rel","crossorigin","integrity","target","data","srcset"],ALLOW_UNKNOWN_PROTOCOLS:!0})}getFileBuffer(e){return new Promise(((t,r)=>{e.getBuffer(((e,o)=>{e?r(e):t(o)}))}))}isTextFile(e){return[".html",".css",".js",".json",".txt",".md",".xml",".svg"].some((t=>e.toLowerCase().endsWith(t)))}getContentType(e){return{html:"text/html",htm:"text/html",css:"text/css",js:"application/javascript",mjs:"application/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",webp:"image/webp",ico:"image/x-icon",woff:"font/woff",woff2:"font/woff2",ttf:"font/ttf",otf:"font/otf",eot:"application/vnd.ms-fontobject",mp4:"video/mp4",webm:"video/webm",mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",pdf:"application/pdf"}[e.toLowerCase().split(".").pop()]||"application/octet-stream"}showSiteViewer(e,t,r){const o=document.getElementById("main-content"),i=document.getElementById("site-viewer"),s=document.getElementById("current-hash"),n=document.getElementById("cache-status"),a=document.getElementById("site-frame");o&&o.classList.add("hidden"),i&&i.classList.remove("hidden"),s&&(s.textContent=`Hash: ${t.substring(0,16)}...`),n&&(n.textContent=r?"üíæ From Cache":"üåê Fresh Download"),a&&(a.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-modals"),a.onerror=e=>{this.log("Iframe error: "+e.message)},a.onload=()=>{this.log("Iframe loaded successfully")},a.src=e),this.log(`Site loaded in iframe: ${e}`)}showMainContent(){const e=document.getElementById("site-viewer"),t=document.getElementById("main-content"),r=document.getElementById("site-frame");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),r&&(r.src=""),this.currentSiteData=null,this.currentHash=null,this.sendToServiceWorker("SITE_UNLOADED",{}),window.history.pushState({},"",window.location.pathname)}showLoadingOverlay(){const e=document.getElementById("loading-overlay");e&&e.classList.remove("hidden")}hideLoadingOverlay(){const e=document.getElementById("loading-overlay");e&&e.classList.add("hidden")}updateProgress(e){const t=Math.round(100*e.progress),r=document.getElementById("loading-progress-bar"),o=document.getElementById("loading-progress-text");let i=t,s=`Downloading: ${t}%`;if(t>=95&&t<100){const t=e.files.filter((e=>e.progress>=.9)).length,r=e.files.length;s=`Processing files: ${t}/${r} ready`,i=Math.round(t/r*100)}else 100===t&&(s="Download complete!");if(r&&(r.style.width=`${i}%`),o&&(o.textContent=s),this.debug){const e=document.getElementById("progress-bar"),t=document.getElementById("progress-text");e&&(e.style.width=`${i}%`),t&&(t.textContent=`Progress: ${s}`)}}updatePeerStats(e){const t=document.getElementById("peer-stats"),r=e.files.filter((e=>e.progress>=.9)).length,o=e.files.length,i=`Peers: ${e.numPeers} | Files: ${r}/${o} ready | Downloaded: ${this.formatBytes(e.downloaded)} | Speed: ${this.formatBytes(e.downloadSpeed)}/s`;t&&(t.textContent=i),this.log(`Peer stats: ${i}`)}formatBytes(e){if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]}toggleDebug(){this.debug=!this.debug,this.updateDebugToggle(),this.debug?this.showDebugPanel():this.hideDebugPanel()}updateDebugToggle(){const e=document.getElementById("debug-toggle");e&&(e.textContent=this.debug?"üêõ Disable Debug Mode":"üêõ Enable Debug Mode")}showDebugPanel(){const e=document.getElementById("debug-panel");e&&e.classList.remove("hidden")}hideDebugPanel(){const e=document.getElementById("debug-panel");e&&e.classList.add("hidden")}log(e){if(console.log(`[PeerWeb] ${e}`),this.debug){const t=document.getElementById("debug-content");if(t){const r=(new Date).toLocaleTimeString();t.innerHTML+=`<div>[${r}] ${e}</div>`,t.scrollTop=t.scrollHeight}}}showError(e){console.error("[PeerWeb Error]",e),alert("PeerWeb Error: "+e)}async clearCache(){await this.cache.clear(),this.log("Cache cleared"),alert("Cache cleared successfully!")}showTorrentModal(){const e=document.getElementById("torrent-modal");e&&e.classList.remove("hidden")}hideTorrentModal(){const e=document.getElementById("torrent-modal");e&&e.classList.add("hidden");const t=document.getElementById("file-input"),r=document.getElementById("file-list"),o=document.getElementById("create-torrent-btn"),i=document.getElementById("torrent-result");t&&(t.value=""),r&&(r.innerHTML=""),o&&(o.disabled=!0),i&&i.classList.add("hidden")}handleFileSelection(e){const t=Array.from(e.target.files),r=document.getElementById("file-list"),o=document.getElementById("create-torrent-btn");r&&(r.innerHTML="<h4>Selected Files:</h4>",t.forEach((e=>{const t=document.createElement("div");t.textContent=e.webkitRelativePath||e.name,r.appendChild(t)}))),o&&(o.disabled=0===t.length)}createTorrent(){const e=document.getElementById("file-input");if(!e||!e.files)return void alert("Please select files first!");const t=Array.from(e.files);if(0===t.length)return void alert("Please select files first!");if(!this.clientReady||!this.client)return void alert("WebTorrent client not ready. Please wait a moment and try again.");if(!t.some((e=>(e.webkitRelativePath||e.name).toLowerCase().includes("index.html")))&&!confirm("No index.html found. Continue anyway? (Site may not load properly)"))return;this.log(`Creating torrent with ${t.length} files...`);const r=document.getElementById("create-torrent-btn"),o=r.textContent;r.disabled=!0,r.textContent="Creating Torrent...";try{this.client.seed(t,{announce:this.trackers,name:this.generateTorrentName(t),comment:"Created with PeerWeb - Decentralized Website Hosting",createdBy:"PeerWeb v1.0",private:!1,pieceLength:this.calculateOptimalPieceLength(t)},(e=>{this.log(`Torrent created successfully: ${e.infoHash}`),this.log(`Torrent name: ${e.name}`),this.log(`Files: ${e.files.length}`),r.disabled=!1,r.textContent=o,this.showTorrentCreationResult(e)}))}catch(e){this.log(`Error creating torrent: ${e.message}`),console.error("Torrent creation error:",e),r.disabled=!1,r.textContent=o,alert("Error creating torrent: "+e.message)}}generateTorrentName(e){if(1===e.length)return e[0].name.replace(/\.[^/.]+$/,"");const t=e.map((e=>e.webkitRelativePath||e.name));if(t.length>0&&t[0].includes("/")){const e=t[0].split("/")[0];if(t.every((t=>t.startsWith(e))))return e}return`PeerWeb-Site-${Date.now()}`}calculateOptimalPieceLength(e){const t=e.reduce(((e,t)=>e+t.size),0);return t<16777216?16384:t<268435456?32768:t<1073741824?262144:1048576}showTorrentCreationResult(e){const t=document.getElementById("torrent-result"),r=document.getElementById("created-hash"),o=document.getElementById("created-url"),i=document.getElementById("download-torrent"),s=e.infoHash,n=`${window.location.origin}${window.location.pathname}?orc=${s}`;if(r&&(r.textContent=s),o&&(o.textContent=n),i&&e.torrentFile)try{const t=new Blob([e.torrentFile],{type:"application/x-bittorrent"}),r=URL.createObjectURL(t);i.href=r,i.download=`${e.name||"website"}.torrent`,i.style.display="inline-flex",this.log(`Torrent file created: ${e.torrentFile.byteLength} bytes`)}catch(e){this.log(`Error creating torrent file download: ${e.message}`),i.style.display="none"}t&&t.classList.remove("hidden")}}class PeerWebCache{constructor(){this.dbName="PeerWebCache",this.version=1,this.storeName="sites",this.maxAge=6048e5}async openDB(){return new Promise(((e,t)=>{const r=indexedDB.open(this.dbName,this.version);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(this.storeName)){t.createObjectStore(this.storeName,{keyPath:"hash"}).createIndex("timestamp","timestamp")}}}))}async set(e,t){try{const r=await this.openDB(),o=r.transaction([this.storeName],"readwrite").objectStore(this.storeName),i={hash:e,data:t,timestamp:Date.now()};await o.put(i),console.log(`[PeerWebCache] Cached site: ${e}`)}catch(e){console.error("[PeerWebCache] Error caching site:",e)}}async get(e){try{const t=await this.openDB(),r=t.transaction([this.storeName],"readonly").objectStore(this.storeName);return new Promise(((t,o)=>{const i=r.get(e);i.onsuccess=()=>{const r=i.result;r&&Date.now()-r.timestamp<this.maxAge?(console.log(`[PeerWebCache] Cache hit: ${e}`),t(r.data)):(r&&this.delete(e),t(null))},i.onerror=()=>o(i.error)}))}catch(e){return console.error("[PeerWebCache] Error retrieving from cache:",e),null}}async delete(e){try{const t=await this.openDB(),r=t.transaction([this.storeName],"readwrite").objectStore(this.storeName);await r.delete(e)}catch(e){console.error("[PeerWebCache] Error deleting from cache:",e)}}async clear(){try{const e=await this.openDB(),t=e.transaction([this.storeName],"readwrite").objectStore(this.storeName);await t.clear(),console.log("[PeerWebCache] Cache cleared")}catch(e){console.error("[PeerWebCache] Error clearing cache:",e)}}}document.addEventListener("DOMContentLoaded",(()=>{window.peerWeb=new PeerWeb}));
    </script>
</body>
</html>